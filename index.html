<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="chatTitle">Chat Gemini Oficial - Edición Global Funcional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4oyl8ZXuKzxg+B1cRzQvEmnKKSXvJQuXo8jF6M2K0GBI00JgZzW/H97K15zQ6Hv7h2z+g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* styles.css */
        body {
    font-family: 'Arial', sans-serif;
    background-color: #2c3e50;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    color: #fff;
    transition: background-color 0.3s ease;
}
.search-container {
  padding: 10px;
  background-color: #2c3e50;
  border-bottom: 1px solid #455a64;
    display: flex;
    justify-content: center;
    align-items: center;
}
.search-container input {
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #455a64;
  background-color: #34495e;
  color:#fff;
  width: 90%;
  max-width: 700px;
}
.chat-container {
    background-color: #34495e;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    width: 90%;
    max-width: 800px;
    display: flex;
    flex-direction: column;
}
.chat-header {
    background-color: #2c3e50;
    color: #fff;
    padding: 20px;
    text-align: center;
    display: flex;
    justify-content: space-between;
    align-items: center;
     border-bottom: 1px solid #455a64;
}
.chat-title {
    font-size: 1.5em;
    margin:0;
}
.clear-chat-button {
    background-color: transparent;
    border:none;
    color:#fff;
    cursor: pointer;
    transition: color 0.3s;
    padding: 0;
}

.clear-chat-button:hover {
    color:#ccc;
}
.save-chat-button,
.load-chat-button {
    background-color: transparent;
    border:none;
    color:#fff;
    cursor: pointer;
    transition: color 0.3s;
    padding: 0;
        margin-right: 10px;
}

.save-chat-button:hover,
.load-chat-button:hover {
    color:#ccc;
}
.chat-actions{
    display: flex;
    align-items: center;
}
.chat-messages {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    scroll-behavior: smooth;
}
.message {
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 10px;
    max-width: 80%;
    position: relative;
}
.user-message {
    background-color: #2980b9;
    align-self: flex-end;
    animation: fadeInRight 0.3s ease;
}
.gemini-message {
    background-color: #34495e;
    align-self: flex-start;
    animation: fadeInLeft 0.3s ease;
}
.copy-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: transparent;
    border: none;
    color: #fff;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.3s;
    padding: 0;
}
.copy-button:hover {
    opacity:1;
}
.chat-input-area {
    padding: 10px;
    background-color: #2c3e50;
    border-top: 1px solid #455a64;
}
.input-container {
   display: flex;
    align-items: center;
}
.chat-input-area input {
    flex-grow: 1;
    padding: 15px;
    border: 1px solid #455a64;
    border-radius: 5px;
    margin-right: 10px;
    background-color: #34495e;
    color:#fff;
    margin-left: 10px;
}
.chat-input-area button {
    padding: 15px 25px;
    border: none;
    border-radius: 5px;
    background-color: #2980b9;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-left: 5px;
     margin-right: 10px;
}
.chat-input-area button:hover {
     background-color: #2473ab;
}
.loading-indicator {
    text-align: center;
    padding: 10px;
    color: #ccc;
    margin-top: 10px;
}
.highlight {
   background-color: yellow;
    color: black;
}
/* Configuración */

.chat-settings .settings-button {
    background-color: transparent;
    border:none;
    color:#fff;
    cursor: pointer;
    font-size: 1.5em;
    transition: color 0.3s;
    padding: 0;
}
.chat-settings .settings-button:hover {
    color: #ccc;
}

/* Estilos del Modal */
.settings-modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.7);
}
.modal-content {
    background-color: #34495e;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    position: relative;
    border-radius: 8px;
}
.close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    color: #fff;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}
.close-button:hover {
    color: #ccc;
}
.settings-options > div{
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.settings-options label{
    margin-right: 10px;
}
.settings-options select{
    padding: 10px;
    border-radius: 5px;
    border: none;
    background-color: #2c3e50;
    color: #fff;
}

 /* Animaciones */
@keyframes fadeInRight {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  @keyframes fadeInLeft {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
}
/* temas  */
body.light-theme {
    background-color: #f0f0f0;
    color: #333;
}
body.light-theme .chat-container {
    background-color: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);

}
body.light-theme .chat-header {
     background-color: #f0f0f0;
    color:#333;
      border-bottom: 1px solid #ccc;
}
body.light-theme .chat-messages {
      background-color: #fff;
}
body.light-theme .user-message {
    background-color: #e1f5fe;
     color: #333;

}
body.light-theme .gemini-message {
      background-color: #f0f0f0;
    color: #333;

}

body.light-theme .chat-input-area {
    background-color: #f0f0f0;
    border-top: 1px solid #ccc;
}

body.light-theme .chat-input-area input {
    background-color: #fff;
     border: 1px solid #ccc;
     color: #333;
}

body.light-theme .chat-input-area button {
   background-color: #2980b9;
    color: white;
}
body.light-theme .chat-input-area button:hover {
      background-color: #2473ab;

}
body.light-theme .settings-modal .modal-content{
     background-color: #fff;
     color: #333;
}
body.light-theme .settings-modal  select{
  background-color: #ccc;
  color: #333;
}
body.light-theme .settings-modal .close-button{
    color: #333;
}
body.light-theme .search-container {
  background-color: #f0f0f0;
  border-bottom: 1px solid #ccc;
}
body.light-theme .search-container input {
  background-color: #fff;
    border: 1px solid #ccc;
    color:#333;
}
/* Idiomas */
.language-selector {
  margin-right: 10px;
}

.language-selector select {
     padding: 10px;
    border-radius: 5px;
    border: none;
     background-color: #2c3e50;
    color: #fff;
}

.voice-button {
    background-color: transparent;
    border:none;
    color:#fff;
    cursor: pointer;
    font-size: 1.2em;
    transition: color 0.3s;
    padding: 0;
    margin-right: 5px;
}
.voice-button:hover {
    color:#ccc;
}
.voice-button.active {
    color:#ccc;
}
.user-message-color {
     background-color: #2980b9;
}

.gemini-message-color{
    background-color: #34495e;
}
body.light-theme .user-message-color {
    background-color: #e1f5fe;
    color: #333;
}
body.light-theme .gemini-message-color{
    background-color: #f0f0f0;
    color: #333;
}
/* Estilos para la tarjeta de Pinterest */
.pinterest-message {
    background-color: #34495e;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    align-self: flex-start;
    animation: fadeInLeft 0.3s ease;
     max-width: 80%;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.pinterest-message.light-theme {
    background-color: #f0f0f0;
     color: #333;
}
.pinterest-message .pinterest-image {
    max-width: 100%;
    height: auto;
    border-radius: 5px;
     object-fit: cover;
}

.pinterest-message .pinterest-title {
    font-size: 1.2em;
    margin: 0;
}
.pinterest-message .pinterest-link {
    color: #2980b9;
    text-decoration: none;
}

.pinterest-message .pinterest-link:hover {
    text-decoration: underline;
}
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1 class="chat-title" data-i18n="chatTitle">Chat Gemini Oficial</h1>
            <div class="chat-settings">
                <button class="settings-button"  aria-label="Abrir Configuración"><i class="fas fa-cog"></i></button>
            </div>
                <div class="chat-actions">
                 <button class="save-chat-button" data-i18n="saveChatButton" aria-label="Guardar Chat">
                     <i class="fas fa-save"></i>
                    </button>
                 <input type="file" id="load-chat-input" style="display:none" accept=".json" aria-label="Cargar Chat"/>
                 <button class="load-chat-button" data-i18n="loadChatButton" aria-label="Cargar Chat">
                      <i class="fas fa-upload"></i>
                    </button>
                 <button class="clear-chat-button" data-i18n="clearChatButton" aria-label="Limpiar Chat">
                    <i class="fas fa-trash"></i>
                </button>
                </div>
        </div>
         <div class="search-container">
            <input type="text" id="search-input" placeholder="Buscar en el chat..." aria-label="Buscar en el chat"/>
        </div>
          <div class="chat-messages" id="chat-messages" aria-live="polite">
              <div class="loading-indicator" id="loading-indicator" style="display: none;" data-i18n="loadingIndicator">
                <i class="fas fa-spinner fa-spin"></i> Gemini está escribiendo...
            </div>
        </div>

        <div class="chat-input-area">
           <div class="input-container">
              <button class="voice-button" id="voice-button" data-i18n="sendByVoice"  aria-label="Enviar por Voz"><i class="fas fa-microphone"></i></button>
              <input type="text" id="user-input" placeholder="Escribe tu mensaje..." aria-label="Escribe tu mensaje" data-i18n="inputPlaceholder"/>
               <div class="language-selector">
                   <select id="language-selector"  aria-label="Seleccionar Idioma" >
                     <option value="es" data-lang="es" > <i class="flag-icon flag-icon-es"></i> Español</option>
                       <option value="en"  data-lang="en"  > <i class="flag-icon flag-icon-gb"></i> Inglés</option>
                      <option value="fr" data-lang="fr" > <i class="flag-icon flag-icon-fr"></i> Francés</option>
                    <option value="de"  data-lang="de" ><i class="flag-icon flag-icon-de"></i> Alemán</option>
                       </select>
                </div>
              <button id="send-button" aria-label="Enviar Mensaje" data-i18n="sendButton">
                   <i class="fas fa-paper-plane"></i> Enviar
               </button>
            </div>
        </div>


    <!-- Modal de Configuración -->
    <div class="settings-modal" id="settings-modal">
            <div class="modal-content">
                 <span class="close-button" id="close-settings-modal" aria-label="Cerrar Configuración">×</span>
                <h2 data-i18n="settingsTitle">Configuración</h2>
                <div class="settings-options">
                    <div>
                       <label for="theme-selector" data-i18n="themeLabel">Tema:</label>
                          <select id="theme-selector" aria-label="Seleccionar tema">
                             <option value="dark" data-i18n="themeDark">Oscuro</option>
                             <option value="light" data-i18n="themeLight">Claro</option>
                         </select>
                    </div>
                    <div>
                       <label for="font-selector" data-i18n="fontLabel">Fuente:</label>
                          <select id="font-selector" aria-label="Seleccionar fuente">
                             <option value="Arial">Arial</option>
                             <option value="Roboto">Roboto</option>
                             <option value="Open Sans">Open Sans</option>
                        </select>
                     </div>
                    <div>
                       <label for="translation-selector" data-i18n="translationLabel">Traducción:</label>
                        <select id="translation-selector" aria-label="Seleccionar traducción">
                            <option value="disabled" data-i18n="translationDisabled">Desactivado</option>
                            <option value="enabled" data-i18n="translationEnabled">Activado</option>
                        </select>
                      </div>
                </div>
           </div>
        </div>
  </div>
    <script>
        /* chat.js */
          class ChatMessage {
    constructor(text, isUser, language = 'es') {
        this.text = text;
        this.isUser = isUser;
         this.language = language;
    }
}

const chatMessagesDiv = document.getElementById('chat-messages');
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');
const clearChatButton = document.querySelector('.clear-chat-button');
const settingsButton = document.querySelector('.settings-button');
const settingsModal = document.getElementById('settings-modal');
const closeSettingsModal = document.getElementById('close-settings-modal');
const themeSelector = document.getElementById('theme-selector');
const fontSelector = document.getElementById('font-selector');
const languageSelector = document.getElementById('language-selector');
const translationSelector = document.getElementById('translation-selector');
const voiceButton = document.getElementById('voice-button');
const saveChatButton = document.querySelector('.save-chat-button');
const loadChatButton = document.querySelector('.load-chat-button');
const loadChatInput = document.getElementById('load-chat-input');
const searchInput = document.getElementById('search-input');

const loadingIndicator = document.getElementById('loading-indicator');
const apiKey = 'AIzaSyB67nQ8iixZePLp9JNj_1oEDn0TJSvkLso';
let chatHistory = [];
let isVoiceRecognitionActive = false;
let recognition;
let translations = {};
let currentLanguage = localStorage.getItem('chatLanguage') || 'es';
function showLoadingIndicator(show) {
    loadingIndicator.style.display = show ? 'block' : 'none';
}

function loadChatHistory() {
    const storedHistory = localStorage.getItem('chatHistory');
      if (storedHistory) {
         chatHistory = JSON.parse(storedHistory);
         chatHistory.forEach(message => addMessageToChat(message));
     }
 }

function saveChatHistory() {
   localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
}
function applyTranslations() {
document.querySelectorAll('[data-i18n]').forEach(element => {
   const key = element.getAttribute('data-i18n');
    if (translations[key]) {
       element.textContent = translations[key];
   }
   if(key === 'inputPlaceholder'){
       element.placeholder =  translations[key];
  }
   if (key === 'searchPlaceholder'){
        searchInput.placeholder = translations[key];
    }
});
}
function addMessageToChat(message) {
     const messageDiv = document.createElement('div');
     messageDiv.classList.add('message');
    if (message.isUser) {
        messageDiv.classList.add('user-message');
          messageDiv.classList.add('user-message-color');
         messageDiv.innerHTML = message.text;
    } else {
        messageDiv.classList.add('gemini-message');
         messageDiv.classList.add('gemini-message-color');
          let translatedText = message.text;
             if (translationSelector.value === 'enabled' && message.language !== languageSelector.value ) {
                 translateText(message.text, message.language, languageSelector.value).then(translation => {
                      translatedText = translation;
                     messageDiv.innerHTML = `${translatedText}  <button class="copy-button" onclick="copyToClipboard(this)"><i class="fas fa-copy"></i></button>`;
                });
            }else {
                messageDiv.innerHTML = `${translatedText}  <button class="copy-button" onclick="copyToClipboard(this)"><i class="fas fa-copy"></i></button>`;
            }
    }
   chatMessagesDiv.appendChild(messageDiv);
    chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
}
async function translateText(text, sourceLang, targetLang) {
    try {
        const response = await fetch('https://translation.googleapis.com/language/translate/v2', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Goog-Api-Key': apiKey,
            },
            body: JSON.stringify({
                q: text,
                source: sourceLang,
                target: targetLang
            }),
        });
        if (!response.ok) {
            throw new Error('Error al traducir el texto: ' + response.status);
        }
       const data = await response.json();
        return data.data.translations[0].translatedText;
    } catch (error) {
        console.error("Error al traducir:", error);
        return text;
    }
}
function copyToClipboard(button) {
    const messageText = button.parentElement.innerText;
    navigator.clipboard.writeText(messageText)
        .then(() => {
           console.log('Texto copiado al portapapeles');
       })
        .catch(err => {
            console.error('Error al copiar texto: ', err);
        });
}

async function sendMessage() {
    const messageText = userInput.value.trim();
    if (!messageText) return;
      const userMessage = new ChatMessage(messageText, true, languageSelector.value);
            addMessageToChat(userMessage);
            chatHistory.push(userMessage);
            saveChatHistory();
            userInput.value = '';
            showLoadingIndicator(true);
    try {
         const url = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-goog-api-key': apiKey
            },
              body: JSON.stringify({
                contents: [{
                    parts: [{ text: messageText }]
                }]
            }),
        });
        if (!response.ok) {
            const error = await response.json();
             const errorMensaje = new ChatMessage(`Error al obtener respuesta: ${error.error.message}`, false);
           addMessageToChat(errorMensaje);
              chatHistory.push(errorMensaje);
             saveChatHistory();
               showLoadingIndicator(false);
            console.error("Error al consumir el API", response.status, error.error.message);
            return;
        }
        const data = await response.json();
        const geminiResponseText = data.candidates[0].content.parts[0].text;
        const geminiMessage = new ChatMessage(geminiResponseText, false, 'en');
         addMessageToChat(geminiMessage);
        chatHistory.push(geminiMessage);
          saveChatHistory();
         showLoadingIndicator(false);
    } catch (error) {
        const errorMensaje = new ChatMessage("Error inesperado. Inténtalo de nuevo más tarde.", false);
        addMessageToChat(errorMensaje);
        chatHistory.push(errorMensaje);
        saveChatHistory();
            showLoadingIndicator(false);
       console.error("Error inesperado:", error);

    }

}
  function clearChat() {
        chatMessagesDiv.innerHTML = '';
         chatHistory = [];
       localStorage.removeItem('chatHistory');
    }
    function saveChat() {
        const chatData = JSON.stringify(chatHistory);
        const blob = new Blob([chatData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
         const a = document.createElement('a');
       a.href = url;
      a.download = 'chat_history.json';
       document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

    }
    function loadChat(event) {
        const file = event.target.files[0];
          if(!file) return;
           const reader = new FileReader();
        reader.onload = function(e) {
            try {
                 const loadedHistory = JSON.parse(e.target.result);
                  if (Array.isArray(loadedHistory)) {
                      chatHistory = loadedHistory;
                       chatMessagesDiv.innerHTML = '';
                    chatHistory.forEach(message => addMessageToChat(message));
                    saveChatHistory();
                  } else{
                      alert("Formato del archivo no es valido")
                 }

           }catch (error) {
                  alert("Error al cargar el chat:" + error.message);
          }
       };
     reader.readAsText(file);
        loadChatInput.value ='';

    }
    function searchChat(searchTerm){
        const messages = chatMessagesDiv.querySelectorAll('.message');
         messages.forEach(message =>{
             const messageText = message.textContent;
              const regex = new RegExp(searchTerm, 'gi');
               const highlightedText = messageText.replace(regex, '<span class="highlight">$&</span>');
                message.innerHTML = highlightedText;
        });
    }
function toggleSettingsModal() {
    settingsModal.style.display = settingsModal.style.display === 'none' ? 'block' : 'none';
}
function applyTheme(theme) {
    document.body.classList.remove('light-theme');
    if (theme === 'light') {
        document.body.classList.add('light-theme');
    }
   localStorage.setItem('chatTheme', theme);
}
function applyFont(font) {
    document.body.style.fontFamily = font;
    localStorage.setItem('chatFont', font);
}
async function loadTranslations(lang) {
    try {
        const response = await fetch(`${lang}.json`);
          if (!response.ok) {
              throw new Error(`No se pudo cargar el archivo de idioma ${lang}.json`);
            }
            translations = await response.json();
             applyTranslations();

      } catch (error) {
          console.error("Error al cargar traducciones:", error);
      }
  }
function loadSettings() {
    const storedTheme = localStorage.getItem('chatTheme');
     if (storedTheme) {
        applyTheme(storedTheme);
         themeSelector.value = storedTheme;
     }
     const storedFont = localStorage.getItem('chatFont');
     if (storedFont) {
        applyFont(storedFont);
         fontSelector.value = storedFont;
    }
    const storedTranslation = localStorage.getItem('chatTranslation');
     if (storedTranslation) {
        translationSelector.value = storedTranslation;
     }
    loadTranslations(currentLanguage);
     languageSelector.value = currentLanguage;
}
  function handleSettingsChange(event) {
     const selectedTheme = themeSelector.value;
   const selectedFont = fontSelector.value;
      const selectedTranslation = translationSelector.value;
  if (event.target.id === 'theme-selector'){
       applyTheme(selectedTheme);
   }
   if (event.target.id === 'font-selector'){
       applyFont(selectedFont);
  }
    if (event.target.id === 'translation-selector'){
          localStorage.setItem('chatTranslation', selectedTranslation);
         chatHistory.forEach(message => addMessageToChat(message));
     }
 }
function startVoiceRecognition() {
  if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
  } else if ('SpeechRecognition' in window) {
      recognition = new SpeechRecognition();
  }
    if(recognition)
    {
         recognition.lang = languageSelector.value;
       recognition.continuous = false;
        recognition.interimResults = false;

       recognition.onstart = () => {
           isVoiceRecognitionActive = true;
         voiceButton.classList.add('active');
           voiceButton.innerHTML = '<i class="fas fa-microphone-slash"></i>';
           console.log('Reconocimiento de voz iniciado.');

       };
        recognition.onresult = (event) => {
             const transcript = event.results[0][0].transcript;
            userInput.value = transcript;
             sendMessage();
          stopVoiceRecognition();
        };
       recognition.onerror = (event) => {
          stopVoiceRecognition();
         console.error('Error en el reconocimiento de voz:', event.error);
       };
         recognition.onend = () => {
             if(isVoiceRecognitionActive) {
                 stopVoiceRecognition();
             }
      };
     recognition.start();
    } else{
        alert('La API de Reconocimiento de Voz no es compatible en este navegador.');
    }
}
function stopVoiceRecognition() {
    if(recognition) {
        recognition.stop();
          voiceButton.classList.remove('active');
        voiceButton.innerHTML = '<i class="fas fa-microphone"></i>';
    }
      isVoiceRecognitionActive = false;
  }
async function handleLanguageChange() {
    currentLanguage = languageSelector.value;
   localStorage.setItem('chatLanguage', currentLanguage);
     await loadTranslations(currentLanguage);
    chatHistory.forEach(message => addMessageToChat(message));
      if(recognition){
          recognition.lang = currentLanguage;
     }
}

clearChatButton.addEventListener('click', clearChat);
  saveChatButton.addEventListener('click', saveChat);
  loadChatInput.addEventListener('change', loadChat);
loadChatButton.addEventListener('click', () => loadChatInput.click());
sendButton.addEventListener('click', sendMessage);
settingsButton.addEventListener('click', toggleSettingsModal);
 closeSettingsModal.addEventListener('click', toggleSettingsModal);
themeSelector.addEventListener('change', handleSettingsChange);
 fontSelector.addEventListener('change', handleSettingsChange);
 translationSelector.addEventListener('change', handleSettingsChange);
 voiceButton.addEventListener('click',  () => {
    if (!isVoiceRecognitionActive) {
        startVoiceRecognition();
    } else {
        stopVoiceRecognition();
   }

});
   searchInput.addEventListener('input', (event) => {
       searchChat(event.target.value);
    });
userInput.addEventListener('keypress', function(event) {
   if (event.key === 'Enter') {
      sendMessage();
    }
});
languageSelector.addEventListener('change', handleLanguageChange);
loadChatHistory();
loadSettings();
  /* commands.js */
    const commandPrefix = "/"; // Prefijo para comandos
const apiKey2 = 'AIzaSyB67nQ8iixZePLp9JNj_1oEDn0TJSvkLso';
let lastPinterestCard = null;

//  Este es el cambio importante!
const originalSendMessage2 = sendMessage;

 sendMessage = async function() {
        const messageText = userInput.value.trim();
           if (!messageText) return;

           if (messageText.startsWith(commandPrefix)) {
             await processCommand(messageText);
           }else {
           originalSendMessage2();
           }
}


async function processCommand(commandText) {
     const trimmedCommand = commandText.trim();
      const commandParts = trimmedCommand.slice(commandPrefix.length).split(/\s+/);
    const commandName = commandParts[0];
      const commandArgs = commandParts.slice(1).join(' ');
    try {
        switch (commandName) {
            case 'wanted':
                await handleWantedCommand(